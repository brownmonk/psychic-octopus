// Generated by CoffeeScript 1.6.2
(function() {
  var routeToRegex;

  routeToRegex = function(route) {
    var escapeRegExp, namedParam, optionalParam, splatParam;

    optionalParam = /\((.*?)\)/g;
    namedParam = /(\(\?)?:\w+/g;
    splatParam = /\*\w+/g;
    escapeRegExp = /[\-{}\[\]+?.,\\\^$|#\s]/g;
    route = route.replace(escapeRegExp, "\\$&").replace(optionalParam, "(?:$1)?").replace(namedParam, function(match, optional) {
      if (optional) {
        return match;
      } else {
        return "([^/]+)";
      }
    }).replace(splatParam, "(.*?)");
    return new RegExp("^" + route + "$");
  };

  bone.router = function(options) {
    var _base, _ref;

    if ((_ref = (_base = bone.router).handlers) == null) {
      _base.handlers = [];
    }
    return $(function() {
      var action, route, _ref1;

      _ref1 = options.routes;
      for (route in _ref1) {
        action = _ref1[route];
        if (route === 'routes') {
          continue;
        }
        route = routeToRegex(route);
        bone.router.handlers.push({
          route: route,
          callback: options[action],
          router: options
        });
      }
      if (options.initialize != null) {
        return options.initialize();
      }
    });
  };

  bone.router.start = function(options) {
    return bone.$(function() {
      bone.history = new bone.History();
      bone.history.handlers = bone.router.handlers;
      return bone.history.start(options);
    });
  };

  bone.router.navigate = function(route, options) {
    return bone.history.navigate(route, options);
  };

}).call(this);
